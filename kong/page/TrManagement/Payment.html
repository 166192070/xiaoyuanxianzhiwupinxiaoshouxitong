<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>商品下单与支付系统</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">

  <!-- 配置Tailwind自定义颜色和字体 -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#3B82F6',
            secondary: '#10B981',
            danger: '#EF4444',
            warning: '#F59E0B',
            dark: '#1F2937',
            light: '#F3F4F6'
          },
          fontFamily: {
            inter: ['Inter', 'system-ui', 'sans-serif'],
          },
        }
      }
    }
  </script>

  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .step-active {
        @apply bg-primary text-white border-primary;
      }
      .step-completed {
        @apply bg-secondary text-white border-secondary;
      }
      .step-pending {
        @apply bg-light text-gray-500 border-gray-300;
      }
      .card-shadow {
        @apply shadow-lg hover:shadow-xl transition-shadow duration-300;
      }
      .btn-primary {
        @apply bg-primary hover:bg-primary/90 text-white font-medium py-2 px-6 rounded-lg transition-all duration-300 transform hover:scale-105;
      }
      .btn-secondary {
        @apply bg-white border border-gray-300 hover:bg-gray-50 text-dark font-medium py-2 px-6 rounded-lg transition-all duration-300;
      }
      .input-field {
        @apply w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none transition-all duration-300;
      }
    }
  </style>
</head>
<body class="font-inter bg-gray-50 text-dark min-h-screen">
<!-- 顶部导航栏 -->
<header class="bg-white shadow-sm sticky top-0 z-50">
  <div class="container mx-auto px-4 py-4 flex justify-between items-center">
    <div class="flex items-center space-x-2">
      <i class="fa fa-shopping-cart text-primary text-2xl"></i>
      <h1 class="text-xl font-bold text-primary">校园购物平台</h1>
    </div>
    <div class="flex items-center space-x-6">
      <a href="#" class="hidden md:block hover:text-primary transition-colors">
        <i class="fa fa-home mr-1"></i>首页
      </a>
      <a href="#" class="hidden md:block hover:text-primary transition-colors">
        <i class="fa fa-user mr-1"></i>我的账户
      </a>
      <a href="#" class="hover:text-primary transition-colors relative">
        <i class="fa fa-bell mr-1"></i>通知
        <span class="absolute -top-2 -right-2 bg-danger text-white text-xs rounded-full h-4 w-4 flex items-center justify-center">2</span>
      </a>
    </div>
  </div>
</header>

<main class="container mx-auto px-4 py-8">
  <!-- 订单流程进度 -->
  <div class="mb-10">
    <h2 class="text-[clamp(1.5rem,3vw,2rem)] font-bold mb-6 text-center">下单流程</h2>
    <div class="flex flex-col md:flex-row items-center justify-between max-w-4xl mx-auto">
      <!-- 步骤1：选择物品 -->
      <div class="flex flex-col items-center mb-4 md:mb-0" id="step-indicator-1">
        <div class="w-10 h-10 rounded-full border-2 step-active flex items-center justify-center mb-2">
          <i class="fa fa-list-ul"></i>
        </div>
        <span class="text-sm font-medium">选择物品</span>
      </div>

      <div class="hidden md:block w-full max-w-[80px] h-1 bg-gray-200 relative">
        <div class="absolute top-0 left-0 h-full bg-primary transition-all duration-500" id="progress-1-2" style="width: 0%"></div>
      </div>

      <!-- 步骤2：确认交易方式 -->
      <div class="flex flex-col items-center mb-4 md:mb-0" id="step-indicator-2">
        <div class="w-10 h-10 rounded-full border-2 step-pending flex items-center justify-center mb-2">
          <i class="fa fa-exchange"></i>
        </div>
        <span class="text-sm font-medium">交易方式</span>
      </div>

      <div class="hidden md:block w-full max-w-[80px] h-1 bg-gray-200 relative">
        <div class="absolute top-0 left-0 h-full bg-primary transition-all duration-500" id="progress-2-3" style="width: 0%"></div>
      </div>

      <!-- 步骤3：填写收货信息 -->
      <div class="flex flex-col items-center mb-4 md:mb-0" id="step-indicator-3">
        <div class="w-10 h-10 rounded-full border-2 step-pending flex items-center justify-center mb-2">
          <i class="fa fa-map-marker"></i>
        </div>
        <span class="text-sm font-medium">收货信息</span>
      </div>

      <div class="hidden md:block w-full max-w-[80px] h-1 bg-gray-200 relative">
        <div class="absolute top-0 left-0 h-full bg-primary transition-all duration-500" id="progress-3-4" style="width: 0%"></div>
      </div>

      <!-- 步骤4：提交订单与支付 -->
      <div class="flex flex-col items-center" id="step-indicator-4">
        <div class="w-10 h-10 rounded-full border-2 step-pending flex items-center justify-center mb-2">
          <i class="fa fa-credit-card"></i>
        </div>
        <span class="text-sm font-medium">支付订单</span>
      </div>
    </div>
  </div>

  <!-- 订单表单 -->
  <div class="max-w-5xl mx-auto bg-white rounded-xl shadow-md overflow-hidden">
    <!-- 步骤1：选择物品 -->
    <div id="step-1" class="p-6 md:p-8">
      <h3 class="text-xl font-bold mb-6 pb-2 border-b border-gray-200">选择您要购买的物品</h3>

      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <!-- 物品1：二手笔记本电脑 -->
        <div class="border border-gray-200 rounded-lg overflow-hidden card-shadow">
          <div class="relative">
            <!-- 笔记本电脑专用图片 -->
            <img src="https://picsum.photos/id/1/400/300" alt="二手笔记本电脑" class="w-full h-48 object-cover">
            <span class="absolute top-2 right-2 bg-primary text-white text-xs py-1 px-2 rounded">可购买</span>
          </div>
          <div class="p-4">
            <h4 class="font-bold text-lg mb-2">二手笔记本电脑</h4>
            <p class="text-gray-600 text-sm mb-3">使用1年，配置良好，无任何故障</p>
            <div class="flex justify-between items-center">
              <span class="text-danger font-bold text-lg">¥2800</span>
              <label class="inline-flex items-center cursor-pointer">
                <input type="radio" name="product" value="1" class="sr-only peer" data-name="二手笔记本电脑" data-price="2800">
                <div class="w-5 h-5 border border-gray-300 rounded-full peer-checked:bg-primary peer-checked:border-primary flex items-center justify-center transition-all">
                  <div class="w-3 h-3 rounded-full bg-white opacity-0 peer-checked:opacity-100 transition-opacity"></div>
                </div>
              </label>
            </div>
          </div>
        </div>

        <!-- 物品2：机械键盘 -->
        <div class="border border-gray-200 rounded-lg overflow-hidden card-shadow">
          <div class="relative">
            <!-- 机械键盘专用图片 -->
            <img src="https://picsum.photos/id/96/400/300" alt="机械键盘" class="w-full h-48 object-cover">
            <span class="absolute top-2 right-2 bg-primary text-white text-xs py-1 px-2 rounded">可购买</span>
          </div>
          <div class="p-4">
            <h4 class="font-bold text-lg mb-2">机械键盘</h4>
            <p class="text-gray-600 text-sm mb-3">青轴，背光，使用3个月，几乎全新</p>
            <div class="flex justify-between items-center">
              <span class="text-danger font-bold text-lg">¥199</span>
              <label class="inline-flex items-center cursor-pointer">
                <input type="radio" name="product" value="2" class="sr-only peer" data-name="机械键盘" data-price="199">
                <div class="w-5 h-5 border border-gray-300 rounded-full peer-checked:bg-primary peer-checked:border-primary flex items-center justify-center transition-all">
                  <div class="w-3 h-3 rounded-full bg-white opacity-0 peer-checked:opacity-100 transition-opacity"></div>
                </div>
              </label>
            </div>
          </div>
        </div>

        <!-- 物品3：大学物理教材 -->
        <div class="border border-gray-200 rounded-lg overflow-hidden card-shadow">
          <div class="relative">
            <!-- 教材专用图片 -->
            <img src="https://picsum.photos/id/24/400/300" alt="大学物理教材" class="w-full h-48 object-cover">
            <span class="absolute top-2 right-2 bg-danger text-white text-xs py-1 px-2 rounded">已被下单</span>
          </div>
          <div class="p-4">
            <h4 class="font-bold text-lg mb-2">大学物理教材</h4>
            <p class="text-gray-600 text-sm mb-3">全新未使用，包含配套习题解答</p>
            <div class="flex justify-between items-center">
              <span class="text-danger font-bold text-lg">¥45</span>
              <label class="inline-flex items-center cursor-not-allowed opacity-70">
                <input type="radio" name="product" value="3" disabled class="sr-only peer" data-name="大学物理教材" data-price="45">
                <div class="w-5 h-5 border border-gray-300 rounded-full flex items-center justify-center">
                  <i class="fa fa-lock text-xs text-gray-400"></i>
                </div>
              </label>
            </div>
          </div>
        </div>
      </div>

      <div class="mt-8 flex justify-end">
        <button id="to-step-2" class="btn-primary disabled:opacity-50 disabled:cursor-not-allowed" disabled>
          下一步 <i class="fa fa-arrow-right ml-1"></i>
        </button>
      </div>
    </div>

    <!-- 步骤2：确认交易方式 -->
    <div id="step-2" class="p-6 md:p-8 hidden">
      <h3 class="text-xl font-bold mb-6 pb-2 border-b border-gray-200">选择交易方式</h3>

      <div class="mb-6">
        <div class="flex items-center mb-4 p-4 border border-gray-200 rounded-lg hover:border-primary/50 transition-colors cursor-pointer" id="delivery-option">
          <input type="radio" name="transaction-type" value="delivery" id="transaction-delivery" class="w-5 h-5 text-primary focus:ring-primary/50 mr-3">
          <label for="transaction-delivery" class="cursor-pointer flex-1">
            <h4 class="font-bold">送货上门</h4>
            <p class="text-sm text-gray-600">卖家将物品送到您指定的地点</p>
          </label>
          <i class="fa fa-truck text-primary text-xl"></i>
        </div>

        <div class="flex items-center p-4 border border-gray-200 rounded-lg hover:border-primary/50 transition-colors cursor-pointer" id="pickup-option">
          <input type="radio" name="transaction-type" value="pickup" id="transaction-pickup" class="w-5 h-5 text-primary focus:ring-primary/50 mr-3">
          <label for="transaction-pickup" class="cursor-pointer flex-1">
            <h4 class="font-bold">自行取货</h4>
            <p class="text-sm text-gray-600">前往卖家指定的地点取货</p>
          </label>
          <i class="fa fa-map-marker text-primary text-xl"></i>
        </div>
      </div>

      <div class="bg-light p-4 rounded-lg mb-6">
        <h4 class="font-bold mb-2">已选商品</h4>
        <div class="flex justify-between items-center">
          <span id="selected-product-name">-</span>
          <span id="selected-product-price" class="font-bold text-danger">-</span>
        </div>
      </div>

      <div class="flex justify-between">
        <button id="back-to-step-1" class="btn-secondary">
          <i class="fa fa-arrow-left mr-1"></i> 上一步
        </button>
        <button id="to-step-3" class="btn-primary disabled:opacity-50 disabled:cursor-not-allowed" disabled>
          下一步 <i class="fa fa-arrow-right ml-1"></i>
        </button>
      </div>
    </div>

    <!-- 步骤3：填写收货信息 -->
    <div id="step-3" class="p-6 md:p-8 hidden">
      <h3 class="text-xl font-bold mb-6 pb-2 border-b border-gray-200">填写收货信息</h3>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <label for="recipient-name" class="block text-sm font-medium text-gray-700 mb-1">收件人姓名 <span class="text-danger">*</span></label>
          <input type="text" id="recipient-name" class="input-field" placeholder="请输入收件人姓名">
        </div>

        <div>
          <label for="recipient-phone" class="block text-sm font-medium text-gray-700 mb-1">联系电话 <span class="text-danger">*</span></label>
          <input type="tel" id="recipient-phone" class="input-field" placeholder="请输入联系电话">
        </div>

        <div class="md:col-span-2">
          <label for="delivery-address" class="block text-sm font-medium text-gray-700 mb-1">送货地址 <span class="text-danger">*</span> <span id="address-required-note" class="text-xs bg-warning/20 text-warning px-2 py-0.5 rounded"></span></label>
          <textarea id="delivery-address" rows="3" class="input-field" placeholder="请详细填写送货地址，包括楼栋、单元、房间号等信息"></textarea>
        </div>

        <div class="md:col-span-2">
          <label for="delivery-notes" class="block text-sm font-medium text-gray-700 mb-1">备注信息</label>
          <textarea id="delivery-notes" rows="2" class="input-field" placeholder="请填写其他需要说明的信息（选填）"></textarea>
        </div>
      </div>

      <div class="bg-light p-4 rounded-lg mt-6 mb-6">
        <h4 class="font-bold mb-2">订单摘要</h4>
        <div class="flex justify-between py-1 border-b border-gray-200">
          <span>商品：<span id="summary-product-name">-</span></span>
          <span id="summary-product-price">-</span>
        </div>
        <div class="flex justify-between py-1 border-b border-gray-200">
          <span>交易方式：</span>
          <span id="summary-transaction-type">-</span>
        </div>
        <div class="flex justify-between py-1 font-bold text-lg text-danger mt-2">
          <span>总计：</span>
          <span id="summary-total-price">-</span>
        </div>
      </div>

      <div class="flex justify-between">
        <button id="back-to-step-2" class="btn-secondary">
          <i class="fa fa-arrow-left mr-1"></i> 上一步
        </button>
        <button id="to-step-4" class="btn-primary disabled:opacity-50 disabled:cursor-not-allowed" disabled>
          提交订单并支付 <i class="fa fa-arrow-right ml-1"></i>
        </button>
      </div>
    </div>

    <!-- 步骤4：提交订单与支付 -->
    <div id="step-4" class="p-6 md:p-8 hidden">
      <h3 class="text-xl font-bold mb-6 pb-2 border-b border-gray-200">订单支付</h3>

      <div class="mb-8">
        <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-6">
          <div class="flex items-start">
            <i class="fa fa-check-circle text-secondary text-xl mt-0.5 mr-3"></i>
            <div>
              <h4 class="font-bold text-secondary">订单已创建成功！</h4>
              <p class="text-sm text-gray-600 mt-1">请在 <span id="payment-timer" class="font-bold text-danger">15:00</span> 内完成支付，超时订单将自动取消</p>
            </div>
          </div>
        </div>

        <div class="bg-light p-4 rounded-lg mb-6">
          <h4 class="font-bold mb-3">订单信息</h4>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm">
            <div>
              <span class="text-gray-500">订单编号：</span>
              <span id="order-number" class="font-medium">ORD-20230515-87654</span>
            </div>
            <div>
              <span class="text-gray-500">创建时间：</span>
              <span id="order-time">-</span>
            </div>
            <div>
              <span class="text-gray-500">商品名称：</span>
              <span id="payment-product-name">-</span>
            </div>
            <div>
              <span class="text-gray-500">交易方式：</span>
              <span id="payment-transaction-type">-</span>
            </div>
            <div>
              <span class="text-gray-500">收件人：</span>
              <span id="payment-recipient">-</span>
            </div>
            <div>
              <span class="text-gray-500">联系电话：</span>
              <span id="payment-phone">-</span>
            </div>
            <div class="md:col-span-2">
              <span class="text-gray-500">收货地址：</span>
              <span id="payment-address">-</span>
            </div>
          </div>
        </div>

        <!-- 支付方式 -->
        <div>
          <h4 class="font-bold mb-3">选择支付方式</h4>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="border border-gray-200 rounded-lg p-4 cursor-pointer hover:border-primary transition-colors flex items-center" id="campus-wallet-option">
              <input type="radio" name="payment-method" value="campus" id="payment-campus" class="w-5 h-5 text-primary focus:ring-primary/50 mr-3">
              <label for="payment-campus" class="cursor-pointer flex-1">
                <h5 class="font-medium">校园钱包支付</h5>
                <p class="text-xs text-gray-500">使用校园一卡通余额支付</p>
              </label>
              <i class="fa fa-university text-2xl text-primary"></i>
            </div>

            <div class="border border-gray-200 rounded-lg p-4 cursor-pointer hover:border-primary transition-colors flex items-center" id="wechat-option">
              <input type="radio" name="payment-method" value="wechat" id="payment-wechat" class="w-5 h-5 text-primary focus:ring-primary/50 mr-3">
              <label for="payment-wechat" class="cursor-pointer flex-1">
                <h5 class="font-medium">微信支付</h5>
                <p class="text-xs text-gray-500">使用微信扫码支付</p>
              </label>
              <i class="fa fa-weixin text-2xl text-green-500"></i>
            </div>
          </div>
        </div>
      </div>

      <div class="flex flex-col md:flex-row justify-between items-center border-t border-gray-200 pt-6">
        <div class="mb-4 md:mb-0">
          <span class="text-gray-500">需支付金额：</span>
          <span id="payment-amount" class="text-2xl font-bold text-danger ml-2">-</span>
        </div>
        <div class="flex space-x-4">
          <button id="cancel-order" class="btn-secondary">
            <i class="fa fa-times mr-1"></i> 取消订单
          </button>
          <button id="confirm-payment" class="btn-primary disabled:opacity-50 disabled:cursor-not-allowed" disabled>
            <i class="fa fa-check mr-1"></i> 确认支付
          </button>
        </div>
      </div>
    </div>

    <!-- 支付成功页面 -->
    <div id="payment-success" class="p-6 md:p-8 hidden text-center">
      <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6">
        <i class="fa fa-check text-4xl text-secondary"></i>
      </div>
      <h3 class="text-2xl font-bold mb-2">支付成功！</h3>
      <p class="text-gray-600 mb-8">您的支付已成功提交，金额将暂存于系统担保账户，待确认收货后转至卖家账户</p>

      <div class="bg-light p-6 rounded-lg max-w-md mx-auto mb-8 text-left">
        <div class="flex justify-between py-2 border-b border-gray-200">
          <span>订单编号：</span>
          <span id="success-order-number" class="font-medium"></span>
        </div>
        <div class="flex justify-between py-2 border-b border-gray-200">
          <span>支付金额：</span>
          <span id="success-amount" class="font-bold text-danger"></span>
        </div>
        <div class="flex justify-between py-2 border-b border-gray-200">
          <span>支付方式：</span>
          <span id="success-method"></span>
        </div>
        <div class="flex justify-between py-2">
          <span>支付时间：</span>
          <span id="success-time"></span>
        </div>
      </div>

      <div class="flex flex-col sm:flex-row justify-center space-y-3 sm:space-y-0 sm:space-x-4">
        <a href="#" class="btn-secondary">
          <i class="fa fa-list-alt mr-1"></i> 查看我的订单
        </a>
        <a href="#" class="btn-primary">
          <i class="fa fa-home mr-1"></i> 返回首页
        </a>
      </div>
    </div>
  </div>
</main>

<footer class="bg-dark text-white mt-16">
  <div class="container mx-auto px-4 py-8">
    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
      <div>
        <h4 class="text-lg font-bold mb-4">校园购物平台</h4>
        <p class="text-gray-400 text-sm">为校园师生提供安全、便捷的二手物品交易平台，保障交易双方权益。</p>
      </div>
      <div>
        <h4 class="text-lg font-bold mb-4">帮助中心</h4>
        <ul class="text-gray-400 text-sm space-y-2">
          <li><a href="#" class="hover:text-white transition-colors">交易规则</a></li>
          <li><a href="#" class="hover:text-white transition-colors">支付说明</a></li>
          <li><a href="#" class="hover:text-white transition-colors">常见问题</a></li>
        </ul>
      </div>
      <div>
        <h4 class="text-lg font-bold mb-4">联系我们</h4>
        <ul class="text-gray-400 text-sm space-y-2">
          <li><i class="fa fa-envelope-o mr-2"></i> support@campus-shop.com</li>
          <li><i class="fa fa-phone mr-2"></i> 010-12345678</li>
        </ul>
      </div>
    </div>
    <div class="border-t border-gray-700 mt-8 pt-6 text-center text-gray-500 text-sm">
      © 2023 校园购物平台 版权所有
    </div>
  </div>
</footer>

<script>
  // 全局变量
  let selectedProduct = null;
  let selectedTransactionType = null;
  let paymentTimer = null;

  // DOM 元素
  const step1 = document.getElementById('step-1');
  const step2 = document.getElementById('step-2');
  const step3 = document.getElementById('step-3');
  const step4 = document.getElementById('step-4');
  const paymentSuccess = document.getElementById('payment-success');

  // 步骤指示器
  const stepIndicator1 = document.getElementById('step-indicator-1').querySelector('div');
  const stepIndicator2 = document.getElementById('step-indicator-2').querySelector('div');
  const stepIndicator3 = document.getElementById('step-indicator-3').querySelector('div');
  const stepIndicator4 = document.getElementById('step-indicator-4').querySelector('div');

  // 进度条
  const progress12 = document.getElementById('progress-1-2');
  const progress23 = document.getElementById('progress-2-3');
  const progress34 = document.getElementById('progress-3-4');

  // 按钮
  const toStep2Btn = document.getElementById('to-step-2');
  const backToStep1Btn = document.getElementById('back-to-step-1');
  const toStep3Btn = document.getElementById('to-step-3');
  const backToStep2Btn = document.getElementById('back-to-step-2');
  const toStep4Btn = document.getElementById('to-step-4');
  const cancelOrderBtn = document.getElementById('cancel-order');
  const confirmPaymentBtn = document.getElementById('confirm-payment');

  // 初始化页面
  document.addEventListener('DOMContentLoaded', function() {
    // 产品选择事件
    const productRadios = document.querySelectorAll('input[name="product"]');
    productRadios.forEach(radio => {
      radio.addEventListener('change', function() {
        if (this.checked) {
          selectedProduct = {
            id: this.value,
            name: this.dataset.name,
            price: this.dataset.price
          };
          toStep2Btn.removeAttribute('disabled');
        }
      });
    });

    // 交易方式选择事件
    const transactionRadios = document.querySelectorAll('input[name="transaction-type"]');
    transactionRadios.forEach(radio => {
      radio.addEventListener('change', function() {
        if (this.checked) {
          selectedTransactionType = this.value;
          updateAddressNote();
          toStep3Btn.removeAttribute('disabled');
        }
      });
    });

    // 交易方式选项点击事件
    document.getElementById('delivery-option').addEventListener('click', function() {
      document.getElementById('transaction-delivery').checked = true;
      selectedTransactionType = 'delivery';
      updateAddressNote();
      toStep3Btn.removeAttribute('disabled');
    });

    document.getElementById('pickup-option').addEventListener('click', function() {
      document.getElementById('transaction-pickup').checked = true;
      selectedTransactionType = 'pickup';
      updateAddressNote();
      toStep3Btn.removeAttribute('disabled');
    });

    // 支付方式选择事件
    const paymentRadios = document.querySelectorAll('input[name="payment-method"]');
    paymentRadios.forEach(radio => {
      radio.addEventListener('change', function() {
        if (this.checked) {
          confirmPaymentBtn.removeAttribute('disabled');
        }
      });
    });

    // 支付方式选项点击事件
    document.getElementById('campus-wallet-option').addEventListener('click', function() {
      document.getElementById('payment-campus').checked = true;
      confirmPaymentBtn.removeAttribute('disabled');
    });

    document.getElementById('wechat-option').addEventListener('click', function() {
      document.getElementById('payment-wechat').checked = true;
      confirmPaymentBtn.removeAttribute('disabled');
    });

    // 收货信息输入验证
    const recipientName = document.getElementById('recipient-name');
    const recipientPhone = document.getElementById('recipient-phone');
    const deliveryAddress = document.getElementById('delivery-address');

    function checkInfoComplete() {
      const nameValid = recipientName.value.trim() !== '';
      const phoneValid = recipientPhone.value.trim() !== '';
      const addressValid = selectedTransactionType === 'delivery'
        ? deliveryAddress.value.trim() !== ''
        : true;

      if (nameValid && phoneValid && addressValid) {
        toStep4Btn.removeAttribute('disabled');
      } else {
        toStep4Btn.setAttribute('disabled', 'disabled');
      }
    }

    recipientName.addEventListener('input', checkInfoComplete);
    recipientPhone.addEventListener('input', checkInfoComplete);
    deliveryAddress.addEventListener('input', checkInfoComplete);

    // 步骤导航事件
    toStep2Btn.addEventListener('click', goToStep2);
    backToStep1Btn.addEventListener('click', goToStep1);
    toStep3Btn.addEventListener('click', goToStep3);
    backToStep2Btn.addEventListener('click', goToStep2);
    toStep4Btn.addEventListener('click', goToStep4);
    cancelOrderBtn.addEventListener('click', cancelOrder);
    confirmPaymentBtn.addEventListener('click', completePayment);
  });

  // 更新地址必填提示
  function updateAddressNote() {
    const noteElement = document.getElementById('address-required-note');
    if (selectedTransactionType === 'delivery') {
      noteElement.textContent = '送货上门模式必须填写';
    } else {
      noteElement.textContent = '';
    }
  }

  // 步骤1 -> 步骤2
  function goToStep2() {
    // 更新步骤显示
    step1.classList.add('hidden');
    step2.classList.remove('hidden');

    // 更新步骤指示器
    stepIndicator1.classList.remove('step-active');
    stepIndicator1.classList.add('step-completed');
    stepIndicator2.classList.remove('step-pending');
    stepIndicator2.classList.add('step-active');

    // 更新进度条
    progress12.style.width = '100%';

    // 填充商品信息
    document.getElementById('selected-product-name').textContent = selectedProduct.name;
    document.getElementById('selected-product-price').textContent = `¥${selectedProduct.price}`;
  }

  // 步骤2 -> 步骤1
  function goToStep1() {
    step2.classList.add('hidden');
    step1.classList.remove('hidden');

    stepIndicator2.classList.remove('step-active');
    stepIndicator2.classList.add('step-pending');
    stepIndicator1.classList.remove('step-completed');
    stepIndicator1.classList.add('step-active');

    progress12.style.width = '0%';
  }

  // 步骤2 -> 步骤3
  function goToStep3() {
    step2.classList.add('hidden');
    step3.classList.remove('hidden');

    stepIndicator2.classList.remove('step-active');
    stepIndicator2.classList.add('step-completed');
    stepIndicator3.classList.remove('step-pending');
    stepIndicator3.classList.add('step-active');

    progress23.style.width = '100%';

    // 填充摘要信息
    document.getElementById('summary-product-name').textContent = selectedProduct.name;
    document.getElementById('summary-product-price').textContent = `¥${selectedProduct.price}`;
    document.getElementById('summary-total-price').textContent = `¥${selectedProduct.price}`;

    const transactionText = selectedTransactionType === 'delivery' ? '送货上门' : '自行取货';
    document.getElementById('summary-transaction-type').textContent = transactionText;

    // 更新地址必填提示
    updateAddressNote();
  }

  // 步骤3 -> 步骤2
  function goToStep2() {
    step3.classList.add('hidden');
    step2.classList.remove('hidden');

    stepIndicator3.classList.remove('step-active');
    stepIndicator3.classList.add('step-pending');
    stepIndicator2.classList.remove('step-completed');
    stepIndicator2.classList.add('step-active');

    progress23.style.width = '0%';
  }

  // 步骤3 -> 步骤4
  function goToStep4() {
    step3.classList.add('hidden');
    step4.classList.remove('hidden');

    stepIndicator3.classList.remove('step-active');
    stepIndicator3.classList.add('step-completed');
    stepIndicator4.classList.remove('step-pending');
    stepIndicator4.classList.add('step-active');

    progress34.style.width = '100%';

    // 填充支付页面信息
    const now = new Date();
    document.getElementById('order-time').textContent = now.toLocaleString();

    document.getElementById('payment-product-name').textContent = selectedProduct.name;

    const transactionText = selectedTransactionType === 'delivery' ? '送货上门' : '自行取货';
    document.getElementById('payment-transaction-type').textContent = transactionText;

    document.getElementById('payment-recipient').textContent = document.getElementById('recipient-name').value;
    document.getElementById('payment-phone').textContent = document.getElementById('recipient-phone').value;
    document.getElementById('payment-address').textContent = document.getElementById('delivery-address').value || '无需地址（自行取货）';

    document.getElementById('payment-amount').textContent = `¥${selectedProduct.price}`;

    // 开始支付倒计时
    startPaymentTimer();
  }

  // 开始支付倒计时（15分钟）
  function startPaymentTimer() {
    let minutes = 15;
    let seconds = 0;
    const timerElement = document.getElementById('payment-timer');

    // 清除之前的计时器
    if (paymentTimer) {
      clearInterval(paymentTimer);
    }

    // 更新倒计时显示
    function updateTimer() {
      timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

      if (minutes === 0 && seconds === 0) {
        clearInterval(paymentTimer);
        // 超时处理
        alert('支付超时，订单已自动取消');
        resetOrderProcess();
      } else {
        if (seconds === 0) {
          minutes--;
          seconds = 59;
        } else {
          seconds--;
        }
      }
    }

    // 立即更新一次
    updateTimer();

    // 设置定时器
    paymentTimer = setInterval(updateTimer, 1000);
  }

  // 取消订单
  function cancelOrder() {
    if (confirm('确定要取消订单吗？')) {
      resetOrderProcess();
    }
  }

  // 重置订单流程
  function resetOrderProcess() {
    // 清除计时器
    if (paymentTimer) {
      clearInterval(paymentTimer);
      paymentTimer = null;
    }

    // 显示第一步，隐藏其他步骤
    step4.classList.add('hidden');
    step3.classList.add('hidden');
    step2.classList.add('hidden');
    step1.classList.remove('hidden');

    // 重置步骤指示器
    stepIndicator4.classList.remove('step-active', 'step-completed');
    stepIndicator4.classList.add('step-pending');
    stepIndicator3.classList.remove('step-active', 'step-completed');
    stepIndicator3.classList.add('step-pending');
    stepIndicator2.classList.remove('step-active', 'step-completed');
    stepIndicator2.classList.add('step-pending');
    stepIndicator1.classList.remove('step-pending', 'step-completed');
    stepIndicator1.classList.add('step-active');

    // 重置进度条
    progress12.style.width = '0%';
    progress23.style.width = '0%';
    progress34.style.width = '0%';

    // 重置选择
    document.querySelectorAll('input[name="product"]').forEach(radio => {
      radio.checked = false;
    });
    document.querySelectorAll('input[name="transaction-type"]').forEach(radio => {
      radio.checked = false;
    });
    document.querySelectorAll('input[name="payment-method"]').forEach(radio => {
      radio.checked = false;
    });

    // 重置输入框
    document.getElementById('recipient-name').value = '';
    document.getElementById('recipient-phone').value = '';
    document.getElementById('delivery-address').value = '';
    document.getElementById('delivery-notes').value = '';

    // 重置按钮状态
    toStep2Btn.setAttribute('disabled', 'disabled');
    toStep3Btn.setAttribute('disabled', 'disabled');
    toStep4Btn.setAttribute('disabled', 'disabled');
    confirmPaymentBtn.setAttribute('disabled', 'disabled');

    // 重置变量
    selectedProduct = null;
    selectedTransactionType = null;
  }

  // 完成支付
  function completePayment() {
    // 清除计时器
    if (paymentTimer) {
      clearInterval(paymentTimer);
      paymentTimer = null;
    }

    // 获取选中的支付方式
    const paymentMethod = document.querySelector('input[name="payment-method"]:checked').value;
    const paymentMethodText = paymentMethod === 'campus' ? '校园钱包支付' : '微信支付';

    // 更新成功页面信息
    document.getElementById('success-order-number').textContent = document.getElementById('order-number').textContent;
    document.getElementById('success-amount').textContent = `¥${selectedProduct.price}`;
    document.getElementById('success-method').textContent = paymentMethodText;
    document.getElementById('success-time').textContent = new Date().toLocaleString();

    // 显示支付成功页面
    step4.classList.add('hidden');
    paymentSuccess.classList.remove('hidden');
  }
</script>
</body>
</html>
